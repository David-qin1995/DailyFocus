# 联网搜索功能配置指南

## 功能说明

联网搜索功能允许AI访问互联网获取最新信息，就像ChatGPT一样。支持以下特性：

- ✅ 自动检测需要联网的问题（如"最新新闻"、"今天天气"等）
- ✅ 手动开关控制联网搜索
- ✅ 支持多个搜索引擎（Google、Bing、DuckDuckGo）
- ✅ 显示搜索来源和引用
- ✅ 智能整合搜索结果到回答中

---

## 搜索引擎配置

系统支持三种搜索引擎，按优先级自动选择：

### 1. Google Search (推荐) - 通过 SerpAPI

**优点：** 搜索质量最高，结果最准确

**配置步骤：**

1. 访问 [SerpAPI](https://serpapi.com/)
2. 注册账号（免费版每月100次搜索）
3. 获取 API Key
4. 在 `.env` 文件中添加：

```bash
SERPAPI_KEY=your_serpapi_key_here
```

**价格：**
- 免费版：100次搜索/月
- 付费版：$50/月 起，5000次搜索

---

### 2. Bing Search

**优点：** 微软官方，稳定可靠

**配置步骤：**

1. 访问 [Azure Portal](https://portal.azure.com/)
2. 创建 "Bing Search v7" 资源
3. 获取 API Key
4. 在 `.env` 文件中添加：

```bash
BING_SEARCH_KEY=your_bing_key_here
```

**价格：**
- 免费版：1000次搜索/月
- 付费版：根据使用量计费

---

### 3. DuckDuckGo (默认)

**优点：** 免费，无需API Key，注重隐私

**特点：**
- 无需配置，开箱即用
- 搜索结果相对较少
- 适合简单查询

**无需配置**，系统会自动使用

---

## 环境变量配置

在项目根目录创建或编辑 `.env` 文件：

```bash
# DeepSeek API（必需）
DEEPSEEK_API_KEY=your_deepseek_key

# 数据库配置（必需）
MYSQL_ADDRESS=localhost:3306
MYSQL_USERNAME=root
MYSQL_PASSWORD=your_password

# 搜索引擎（至少配置一个，或使用默认的DuckDuckGo）
# 推荐：配置 SerpAPI 获得最佳搜索体验
SERPAPI_KEY=your_serpapi_key

# 或配置 Bing Search
BING_SEARCH_KEY=your_bing_key

# JWT密钥（必需）
JWT_SECRET=your_jwt_secret
```

---

## 使用方式

### 方式一：手动开关（推荐）

1. 打开聊天页面
2. 点击输入框上方的 **"🌐 联网搜索"** 按钮
3. 按钮变绿表示已开启
4. 发送消息，AI会自动搜索互联网

### 方式二：自动检测

系统会自动检测以下关键词并启用联网搜索：

- **时间相关：** 今天、最新、现在、当前、实时、最近、今年
- **搜索相关：** 搜索、查找、找一下、帮我找、查询
- **新闻相关：** 新闻、消息、事件、发生、报道
- **价格相关：** 价格、多少钱、报价、股价

---

## 示例对话

### ✅ 适合联网搜索的问题

```
用户：今天北京的天气怎么样？
AI：🌐 使用了Google搜索
    根据最新天气信息...

用户：2024年最新的AI技术有哪些？
AI：🌐 使用了Google搜索
    2024年最重要的AI技术突破包括...
    
用户：特斯拉的股价是多少？
AI：🌐 使用了Bing搜索
    根据实时数据，特斯拉(TSLA)当前股价...
```

### ❌ 不需要联网的问题

```
用户：帮我写一段Python代码
AI：好的，这是一段Python代码...

用户：解释一下什么是机器学习
AI：机器学习是一种人工智能的分支...
```

---

## 搜索结果显示

当使用联网搜索时，回复会显示：

1. **搜索徽章** - 显示使用了哪个搜索引擎
2. **引用来源** - AI会在回答中引用搜索结果
3. **参考链接** - 提供搜索结果的原始链接

示例：
```
🌐 使用了Google搜索

根据最新搜索结果，北京今天天气晴朗，温度18-25℃...

参考来源：
1. 中国天气网 - https://...
2. 新浪天气 - https://...
```

---

## 成本估算

### 免费方案（推荐新手）

- 使用 **DuckDuckGo**
- 完全免费
- 适合个人使用和测试

### 低成本方案

- 使用 **SerpAPI 免费版**
- 100次搜索/月
- 适合小型项目

### 生产环境

- 使用 **SerpAPI 付费版** 或 **Bing Search**
- 根据实际使用量付费
- 适合正式产品

---

## 常见问题

### Q: 没有配置API Key能用吗？

**A:** 可以！系统会自动使用 DuckDuckGo，无需任何配置。

### Q: 搜索速度慢怎么办？

**A:** 
1. 确保网络连接正常
2. 建议配置 Bing Search 或 SerpAPI
3. DuckDuckGo 速度相对较慢

### Q: 搜索结果不准确？

**A:** 
1. 推荐使用 SerpAPI (Google)，准确度最高
2. 使用更具体的问题描述
3. 手动开启联网搜索开关

### Q: 如何查看搜索日志？

**A:** 查看服务器日志，搜索 "开始搜索" 关键词

---

## 技术细节

### 搜索流程

1. 用户发送消息
2. 检测是否需要联网（自动或手动）
3. 调用搜索API获取结果
4. 将搜索结果作为上下文提供给AI
5. AI基于搜索结果生成回答
6. 保存搜索信息到消息元数据

### 支持的搜索引擎

| 引擎 | 优先级 | 需要配置 | 准确度 | 速度 |
|------|--------|----------|--------|------|
| Google (SerpAPI) | 1 | 是 | ⭐⭐⭐⭐⭐ | ⚡⚡⚡⚡ |
| Bing Search | 2 | 是 | ⭐⭐⭐⭐ | ⚡⚡⚡⚡ |
| DuckDuckGo | 3 | 否 | ⭐⭐⭐ | ⚡⚡⚡ |

---

## 下一步

1. 根据需求选择合适的搜索引擎
2. 配置 API Key（或使用 DuckDuckGo）
3. 重启服务器
4. 在聊天界面测试联网搜索功能

享受强大的联网AI助手！🚀

